import{R as L}from"./index-DE2vYT7c.js";import{a as T,r,o as I,c as O,e as t,g as S}from"./index-5AmzB_Zl.js";const E={class:"BaseRecorder"},N={class:"BaseRecorder-record"},j={class:"BaseRecorder-play"},z={class:"BaseRecorder-download"},G={class:"BaseRecorder-destroy"},H={class:"BaseRecorder-wave"},X=T({__name:"Admin",setup(J){const o=r(null),n=r(null),i=r(null),b=()=>{let l={sampleBits:16,sampleRate:48e3,numChannels:1,compiling:!1};o.value=new L(l),console.log("recorder.value",o.value)},A=()=>{o.value.start().then(()=>{p()},l=>{console.log(`${l.name} : ${l.message}`)})},c=r(),p=()=>{let l={canvas:c.value,dataArray:o.value.getRecordAnalyseData(),bgcolor:"rgb(50 65 150)",lineWidth:2,lineColor:"rgb(255, 255, 255)"};n.value=requestAnimationFrame(p),y(l),console.log("query",l),console.log("drawRecordId.value",n.value)},y=({canvas:l,dataArray:e,bgcolor:a="rgb(200, 200, 200)",lineWidth:m=2,lineColor:d="rgb(0, 0, 0)"})=>{if(!l)return;const s=c.value.getContext("2d"),C=e.length,M=l.width/C;let g=0;s.fillStyle=a,s.fillRect(0,0,l.width,l.height),s.lineWidth=m,s.strokeStyle=d,s.beginPath();for(let u=0;u<C;u++){const k=e[u]/128*l.height/2;u===0?s.moveTo(g,k):s.lineTo(g,k),g+=M}s.lineTo(l.width,l.height/2),s.stroke()},P=()=>{o.value.resume()},B=()=>{o.value.pause(),n.value&&cancelAnimationFrame(n.value),n.value=null},v=r([]),$=()=>{o.value.stop(),o.value.percentage=0,v.value.push(o.value),n.value&&cancelAnimationFrame(n.value),n.value=null,R()},h=()=>{o.value.play(),f()},w=r(null),f=()=>{i.value=requestAnimationFrame(f),y({canvas:w,dataArray:o.value.getPlayAnalyseData()}),console.log("recorder.value.getPlayAnalyseData()",o.value.getPlayAnalyseData())},W=()=>{o.value.pausePlay()},F=()=>{o.value.resumePlay(),f()},x=()=>{o.value.stopPlay()},V=()=>{o.value.downloadPCM("新文件"),console.log(o.value.downloadPCM("新文件"))},D=()=>{o.value.downloadWAV("新文件"),console.log(o.value.downloadWAV("新文件"))},q=()=>{o.value.destroy().then(function(){n.value&&cancelAnimationFrame(n.value),n.value=null,i.value&&cancelAnimationFrame(i.value),i.value=null,o.value=null})},R=()=>{const l=[];for(const e of v.value){console.log("voiceList.value",v.value),console.log(e.duration.toFixed(0));const a=e.getWAVBlob(),m=new Blob([a],{type:"audio/wav"}),d=new File([m],new Date().getTime()+".wav");l.push(d),console.log("fileOfBlob",d)}return l};return I(()=>{b()}),(l,e)=>(S(),O("div",E,[t("div",N,[t("i",{onClick:e[0]||(e[0]=a=>A()),title:"開始錄音",class:"fa-solid fa-microphone"}),t("i",{onClick:e[1]||(e[1]=a=>P()),title:"继续錄音",class:"fa-solid fa-microphone-lines"}),t("i",{onClick:e[2]||(e[2]=a=>B()),title:"暂停錄音",class:"fa-solid fa-microphone-lines-slash"}),t("i",{onClick:e[3]||(e[3]=a=>$()),title:"停止錄音",class:"fa-solid fa-microphone-slash"})]),t("div",j,[t("i",{onClick:e[4]||(e[4]=a=>h()),class:"fa-solid fa-volume-high"}),t("i",{onClick:e[5]||(e[5]=a=>W()),class:"fa-solid fa-volume-xmark"}),t("button",{onClick:e[6]||(e[6]=a=>F())},"恢复錄音播放"),t("button",{onClick:e[7]||(e[7]=a=>x())},"停止錄音播放")]),t("div",z,[t("i",{onClick:e[8]||(e[8]=a=>V()),title:"下载PCM",class:"fa-solid fa-cloud-arrow-down"}),t("i",{onClick:e[9]||(e[9]=a=>D()),title:"下载WAV",class:"fa-solid fa-cloud-arrow-down"})]),t("div",G,[t("button",{onClick:e[10]||(e[10]=a=>q())},"销毁錄音"),t("i",{onClick:e[11]||(e[11]=a=>R()),title:"上傳",class:"fa-solid fa-cloud-arrow-down"})]),t("div",H,[t("canvas",{ref_key:"record",ref:c},null,512),t("canvas",{ref_key:"play",ref:w},null,512)])]))}});export{X as default};
