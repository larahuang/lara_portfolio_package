var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M(w){return w&&w.__esModule&&Object.prototype.hasOwnProperty.call(w,"default")?w.default:w}var v={exports:{}};/*!
 * 
 * js-audio-recorder - js audio recorder plugin
 * 
 * @version v1.0.7
 * @homepage https://github.com/2fps/recorder
 * @author 2fps <echoweb@126.com> (https://www.zhuyuntao.cn)
 * @license MIT
 *         
 */var b=v.exports,R;function B(){return R||(R=1,function(w,C){(function(m,c){w.exports=c()})(b,function(){return function(m){var c={};function d(a){if(c[a])return c[a].exports;var o=c[a]={i:a,l:!1,exports:{}};return m[a].call(o.exports,o,o.exports,d),o.l=!0,o.exports}return d.m=m,d.c=c,d.d=function(a,o,r){d.o(a,o)||Object.defineProperty(a,o,{enumerable:!0,get:r})},d.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},d.t=function(a,o){if(1&o&&(a=d(a)),8&o||4&o&&typeof a=="object"&&a&&a.__esModule)return a;var r=Object.create(null);if(d.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:a}),2&o&&typeof a!="string")for(var t in a)d.d(r,t,(function(n){return a[n]}).bind(null,t));return r},d.n=function(a){var o=a&&a.__esModule?function(){return a.default}:function(){return a};return d.d(o,"a",o),o},d.o=function(a,o){return Object.prototype.hasOwnProperty.call(a,o)},d.p="",d(d.s=1)}([function(m,c,d){function a(o,r,t){for(var n=0;n<t.length;n++)o.setUint8(r+n,t.charCodeAt(n))}Object.defineProperty(c,"__esModule",{value:!0}),c.compress=function(o,r,t){for(var n=r/t,p=Math.max(n,1),s=o.left,i=o.right,e=Math.floor((s.length+i.length)/n),l=new Float32Array(e),u=0,g=0;u<e;){var f=Math.floor(g);l[u]=s[f],u++,i.length&&(l[u]=i[f],u++),g+=p}return l},c.encodePCM=function(o,r,t){t===void 0&&(t=!0);var n=0,p=o.length*(r/8),s=new ArrayBuffer(p),i=new DataView(s);if(r===8)for(var e=0;e<o.length;e++,n++){var l=(u=Math.max(-1,Math.min(1,o[e])))<0?128*u:127*u;l=+l+128,i.setInt8(n,l)}else for(e=0;e<o.length;e++,n+=2){var u=Math.max(-1,Math.min(1,o[e]));i.setInt16(n,u<0?32768*u:32767*u,t)}return i},c.encodeWAV=function(o,r,t,n,p,s){s===void 0&&(s=!0);var i=t>r?r:t,e=p,l=new ArrayBuffer(44+o.byteLength),u=new DataView(l),g=n,f=0;a(u,f,"RIFF"),f+=4,u.setUint32(f,36+o.byteLength,s),a(u,f+=4,"WAVE"),a(u,f+=4,"fmt "),f+=4,u.setUint32(f,16,s),f+=4,u.setUint16(f,1,s),f+=2,u.setUint16(f,g,s),f+=2,u.setUint32(f,i,s),f+=4,u.setUint32(f,g*i*(e/8),s),f+=4,u.setUint16(f,g*(e/8),s),f+=2,u.setUint16(f,e,s),a(u,f+=2,"data"),f+=4,u.setUint32(f,o.byteLength,s),f+=4;for(var y=0;y<o.byteLength;)u.setUint8(f,o.getUint8(y)),f++,y++;return u}},function(m,c,d){var a,o=this&&this.__extends||(a=function(s,i){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,l){e.__proto__=l}||function(e,l){for(var u in l)l.hasOwnProperty(u)&&(e[u]=l[u])})(s,i)},function(s,i){function e(){this.constructor=s}a(s,i),s.prototype=i===null?Object.create(i):(e.prototype=i.prototype,new e)});Object.defineProperty(c,"__esModule",{value:!0});var r=d(2),t=d(0),n=d(3),p=function(s){function i(e){e===void 0&&(e={});var l=s.call(this,e)||this;return l.isrecording=!1,l.ispause=!1,l.isplaying=!1,l}return o(i,s),i.prototype.setOption=function(e){e===void 0&&(e={}),this.setNewOption(e)},i.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},i.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},i.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},i.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},i.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),n.default.addPlayEnd(this.onplayend);var e=this.getWAV();e.byteLength>44&&n.default.play(e.buffer)},i.prototype.getPlayTime=function(){return n.default.getPlayTime()},i.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),n.default.pausePlay())},i.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),n.default.resumePlay())},i.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),n.default.stopPlay())},i.prototype.destroy=function(){return n.default.destroyPlay(),this.destroyRecord()},i.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},i.prototype.getPlayAnalyseData=function(){return n.default.getAnalyseData()},i.prototype.getPCM=function(){this.stop();var e=this.getData();return e=t.compress(e,this.inputSampleRate,this.outputSampleRate),t.encodePCM(e,this.oututSampleBits,this.littleEdian)},i.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},i.prototype.downloadPCM=function(e){e===void 0&&(e="recorder");var l=this.getPCMBlob();r.downloadPCM(l,e)},i.prototype.getWAV=function(){var e=this.getPCM();return t.encodeWAV(e,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},i.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},i.prototype.downloadWAV=function(e){e===void 0&&(e="recorder");var l=this.getWAVBlob();r.downloadWAV(l,e)},i.prototype.download=function(e,l,u){r.download(e,l,u)},i.prototype.getChannelData=function(){var e=this.getPCM(),l=e.byteLength,u=this.littleEdian,g={left:null,right:null};if(this.config.numChannels===2){var f=new DataView(new ArrayBuffer(l/2)),y=new DataView(new ArrayBuffer(l/2));if(this.config.sampleBits===16)for(var h=0;h<l/2;h+=2)f.setInt16(h,e.getInt16(2*h,u),u),y.setInt16(h,e.getInt16(2*h+2,u),u);else for(h=0;h<l/2;h+=2)f.setInt8(h,e.getInt8(2*h)),y.setInt8(h,e.getInt8(2*h+1));g.left=f,g.right=y}else g.left=e;return g},i}(d(5).default);c.default=p},function(m,c,d){function a(o,r,t){var n=document.createElement("a");n.href=window.URL.createObjectURL(o),n.download=r+"."+t,n.click()}Object.defineProperty(c,"__esModule",{value:!0}),c.downloadWAV=function(o,r){r===void 0&&(r="recorder"),a(o,r,"wav")},c.downloadPCM=function(o,r){r===void 0&&(r="recorder"),a(o,r,"pcm")},c.download=function(o,r,t){return a(o,r,t)}},function(m,c,d){Object.defineProperty(c,"__esModule",{value:!0});var a=d(4),o=null,r=0,t=0,n=null,p=null,s=null,i=!1,e=0,l=function(){};function u(){return i=!1,n.decodeAudioData(s.slice(0),function(y){(o=n.createBufferSource()).onended=function(){i||(e=n.currentTime-t+r,l())},o.buffer=y,o.connect(p),p.connect(n.destination),o.start(0,r),t=n.currentTime},function(y){a.throwError(y)})}function g(){o&&(o.stop(),o=null)}var f=function(){function y(){}return y.play=function(h){return n||(n=new(window.AudioContext||window.webkitAudioContext),(p=n.createAnalyser()).fftSize=2048),this.stopPlay(),s=h,e=0,u()},y.pausePlay=function(){g(),r+=n.currentTime-t,i=!0},y.resumePlay=function(){return u()},y.stopPlay=function(){r=0,s=null,g()},y.destroyPlay=function(){this.stopPlay()},y.getAnalyseData=function(){var h=new Uint8Array(p.frequencyBinCount);return p.getByteTimeDomainData(h),h},y.addPlayEnd=function(h){h===void 0&&(h=function(){}),l=h},y.getPlayTime=function(){var h=i?r:n.currentTime-t+r;return e||h},y}();c.default=f},function(m,c,d){Object.defineProperty(c,"__esModule",{value:!0}),c.throwError=function(a){throw new Error(a)}},function(m,c,d){Object.defineProperty(c,"__esModule",{value:!0});var a=d(0),o=function(){function r(t){t===void 0&&(t={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var n,p=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=p.sampleRate,this.setNewOption(t),this.littleEdian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256),r.initUserMedia()}return r.prototype.setNewOption=function(t){t===void 0&&(t={}),this.config={sampleBits:~[8,16].indexOf(t.sampleBits)?t.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(t.sampleRate)?t.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(t.numChannels)?t.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},r.prototype.startRecord=function(){var t=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(n){t.audioInput=t.context.createMediaStreamSource(n),t.stream=n}).then(function(){t.audioInput.connect(t.analyser),t.analyser.connect(t.recorder),t.recorder.connect(t.context.destination)})},r.prototype.pauseRecord=function(){this.needRecord=!1},r.prototype.resumeRecord=function(){this.needRecord=!0},r.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},r.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},r.prototype.getAnalyseData=function(){var t=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(t),t},r.prototype.getData=function(){return this.flat()},r.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},r.prototype.flat=function(){var t=null,n=new Float32Array(0);this.config.numChannels===1?t=new Float32Array(this.size):(t=new Float32Array(this.size/2),n=new Float32Array(this.size/2));for(var p=0,s=0;s<this.lBuffer.length;s++)t.set(this.lBuffer[s],p),p+=this.lBuffer[s].length;for(p=0,s=0;s<this.rBuffer.length;s++)n.set(this.rBuffer[s],p),p+=this.rBuffer[s].length;return{left:t,right:n}},r.prototype.initRecorder=function(){var t=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var n=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=n.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(p){if(t.needRecord){var s,i=p.inputBuffer.getChannelData(0),e=null;t.lBuffer.push(new Float32Array(i)),t.size+=i.length,t.config.numChannels===2&&(e=p.inputBuffer.getChannelData(1),t.rBuffer.push(new Float32Array(e)),t.size+=e.length),t.fileSize=Math.floor(t.size/Math.max(t.inputSampleRate/t.outputSampleRate,1))*(t.oututSampleBits/8),s=100*Math.max.apply(Math,i),t.duration+=4096/t.inputSampleRate,t.onprocess&&t.onprocess(t.duration),t.onprogress&&t.onprogress({duration:t.duration,fileSize:t.fileSize,vol:s})}}},r.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach(function(t){return t.stop()}),this.stream=null)},r.prototype.closeAudioContext=function(){return this.context&&this.context.close&&this.context.state!=="closed"?this.context.close():new Promise(function(t){t()})},r.initUserMedia=function(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(t){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return n?new Promise(function(p,s){n.call(navigator,t,p,s)}):Promise.reject(new Error("浏览器不支持 getUserMedia !"))})},r.prototype.transformIntoPCM=function(t,n){var p=new Float32Array(t),s=new Float32Array(n),i=a.compress({left:p,right:s},this.inputSampleRate,this.outputSampleRate);return a.encodePCM(i,this.oututSampleBits,this.littleEdian)},r.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){t&&t.getTracks().forEach(function(n){return n.stop()})})},r}();c.default=o}]).default})}(v)),v.exports}var P,A;function S(){return A||(A=1,P=B()),P}var x=S();const D=M(x);export{D as R,_ as c,M as g};
